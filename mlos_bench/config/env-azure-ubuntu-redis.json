{
    "name": "Azure VM Ubuntu Redis",
    "class": "mlos_bench.environment.CompositeEnv",

    "include_tunables": [
        "./mlos_bench/config/tunables.json"
    ],

    "include_services": [
        "./mlos_bench/config/azure/services.json"
    ],

    "config": {

        "children": [
            {
                "name": "Deploy Ubuntu VM on Azure",
                "class": "mlos_bench.environment.azure.VMEnv",

                "config": {

                    "tunable_params": ["provision"],

                    "const_args": {

                        "adminUsername": "os-autotune",
                        "authenticationType": "sshPublicKey",
                        "adminPasswordOrKey": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDZnRBZZWYoPaAf4ZFP3rj1IKpdjW3QySgfOfrw6gUcqWN8OnUdxXzJJ35DxDhtZY3Qq038Y7IHfocrxrKL2ID/rrYvo77/uuqaEpELOXU9YA1ervTqlUagARSfeoUQDOZkDsbm603D4/3t3l0hxNHPGDyqjLtP2U+RelhLEngaSGSvwAiFNHJef8ldDfOxgBSVprBvU+48g4mZp5QZ2O50gzhcoFI2+Ho/Am4el2SS6ptxS1BjeVR1/GoLpB/POYfWqgs5/0rrG2gUyRQZdvY97LhMVd3jUK0DeiRnQpv44fnKTh8px3sl6N5sTg9a4tL8PBZC31MqP7QTj9KqMh8HfMp0wEIXPUWinBpTjXtknZiOWodLuAtZ82GzO8sW5HhXW5ZdU6aaNZ1JUakQX+eWTAzF3qQCp2BDIrXccxa5HMjneLczHug5VH1Y4wo3LyI4QBmxoQzYUsvSDBHAGqSu3u6XJVfJbgA5Di1ykGpVaMda0iLc7wG9ADevEfOmSQIMI2PEW6ZLv/+1w+uHYJi4c+3cIr9nSPpBu1HmefY4Hrz9XtYhFwTAk8RCla9v4WPn0hrVQnTBcuW3a79d87v6O2NIv1gosnsEWpWwIHycIe3G/Y6btsoDHcYMWbWewSOVsTru5UAfiZYZk8psjMwc4wcGkIHxcgzFlWb9r8ZOzw== os-autotune-fake-key",

                        "virtualNetworkName": "os-autotune-vnet",
                        "subnetName": "os-autotune-subnet",
                        "networkSecurityGroupName": "os-autotune-nsg",

                        "ubuntuOSVersion": "18.04-LTS"
                    }
                }
            },
            {
                "name": "Boot Ubuntu VM on Azure",
                "class": "mlos_bench.environment.azure.OSEnv",

                "config": {
                    "tunable_params": ["boot"],
                    "const_args": {}
                }
            },
            {
                "name": "Redis on Linux",
                "class": "mlos_bench.environment.AppEnv",

                "config": {

                    "tunable_params": ["kernel", "redis"],

                    "const_args": {
                        "storageAccountName": "osatsharedstorage",
                        "storageFileShareName": "os-autotune-file-share",
                        "storageAccountKey": "STORAGE ACCOUNT KEY FROM `az storage account keys list`"
                    },

                    "script": [
                        "sudo mkdir -p /mnt/os-autotune",
                        "sudo mount -t cifs //$storageAccountName.file.core.windows.net/$storageFileShareName /mnt/os-autotune -o username=$storageAccountName,password=$storageAccountKey,serverino,nosharesock,actimeo=30",
                        "ls -lap /mnt/os-autotune/os-autotune/common/examples/redis"
                    ],

                    "pollDelay": 10
                }
            }
        ]
    }
}
